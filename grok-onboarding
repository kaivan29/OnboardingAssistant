#!/bin/bash

# Colors
GREEN='\033[0;32m'
CYAN='\033[0;36m'
BLUE='\033[0;34m'
RED='\033[0;31m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color
BOLD='\033[1m'

# ASCII Art
print_banner() {
    echo -e "${CYAN}"
    echo "   ______           __    ____      __                         ___            "
    echo "  / ____/________  / /__ / __ \____/ /_  ____  ____ __________/ (_)___  ____ _"
    echo " / / __/ ___/ __ \/ //_// / / / __  / / / / / / / // / ___/ _  / / __ \/ __ \`/"
    echo "/ /_/ / /  / /_/ / ,<  / /_/ / /_/ / /_/ / /_/ / // / /  / // / / / / / /_/ / "
    echo "\____/_/   \____/_/|_| \____/\__,_/\__,_/\__,_/\_,_/_/   \__,_/_/_/ /_/\__, / "
    echo "                                                                      /____/  "
    echo -e "${NC}"
}

# Loading effect
spinner() {
    local pid=$1
    local delay=0.1
    local spinstr='|/-\'
    while [ "$(ps a | awk '{print $1}' | grep $pid)" ]; do
        local temp=${spinstr#?}
        printf " [%c]  " "$spinstr"
        local spinstr=$temp${spinstr%"$temp"}
        sleep $delay
        printf "\b\b\b\b\b\b"
    done
    printf "    \b\b\b\b"
}

print_banner

PROJECT=$1
XHACK_DIR="$HOME/xHack"

if [ -z "$PROJECT" ]; then
  echo -e "${RED}[ERROR]${NC} Target sequence definition missing."
  echo -e "Usage: ${BOLD}grok-onboarding <project_identifier>${NC}"
  exit 1
fi

# Simple mapping via pseudo-db
if [ "$PROJECT" == "rocksdb" ]; then
  REPO_URL="https://github.com/facebook/rocksdb.git"
else
  echo -e "${RED}[FATAL]${NC} Project signature '${PROJECT}' not found in local registry."
  echo -e "${YELLOW}[HINT]${NC} Only 'rocksdb' protocol is currently authorized."
  exit 1
fi

echo -e "${BLUE}[INIT]${NC} Initializing neural link to ${BOLD}$PROJECT${NC}..."
sleep 0.5

echo -e "${BLUE}[SYS]${NC} Verifying workspace integrity at ${CYAN}$XHACK_DIR${NC}..."
mkdir -p "$XHACK_DIR"
cd "$XHACK_DIR" || exit 1

if [ -d "$PROJECT" ]; then
    echo -e "${GREEN}[OK]${NC} Local cache found. Skipping quantum replication."
else
    echo -e "${YELLOW}[NET]${NC} Establishing downlink from ${REPO_URL}..."
    git clone "$REPO_URL" &
    spinner $!
    echo -e "${GREEN}[SUCCESS]${NC} Codebase extraction complete."
fi

# Simulate processing
echo -n "Analyzing vector compatibility..."
sleep 0.5
echo -e " ${GREEN}[OK]${NC}"

# Open the app
URL="http://localhost:3000?codebase=$PROJECT"
echo -e "${BLUE}[LAUNCH]${NC} Engaging visualization interface..."
open "$URL"

echo -e "\n${BOLD}>> SYSTEM READY. GOOD LUCK, RECRUIT.${NC}\n"
